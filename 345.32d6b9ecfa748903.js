"use strict";(self.webpackChunkcvs=self.webpackChunkcvs||[]).push([[345],{345:(K,T,a)=>{a.r(T),a.d(T,{WebSocketModule:()=>X});var p=a(9808),Z=a(9516),e=a(5e3),w=a(4850),b=a(8929),N=a(3489),k=a(6498),E=a(2654),S=a(839);const J={url:"",deserializer:o=>JSON.parse(o.data),serializer:o=>JSON.stringify(o)};class y extends b.ug{constructor(n,t){if(super(),n instanceof k.y)this.destination=t,this.source=n;else{const s=this._config=Object.assign({},J);if(this._output=new b.xQ,"string"==typeof n)s.url=n;else for(let i in n)n.hasOwnProperty(i)&&(s[i]=n[i]);if(!s.WebSocketCtor&&WebSocket)s.WebSocketCtor=WebSocket;else if(!s.WebSocketCtor)throw new Error("no WebSocket constructor can be found");this.destination=new S.t}}lift(n){const t=new y(this._config,this.destination);return t.operator=n,t.source=this,t}_resetState(){this._socket=null,this.source||(this.destination=new S.t),this._output=new b.xQ}multiplex(n,t,s){const i=this;return new k.y(r=>{try{i.next(n())}catch(u){r.error(u)}const c=i.subscribe(u=>{try{s(u)&&r.next(u)}catch(l){r.error(l)}},u=>r.error(u),()=>r.complete());return()=>{try{i.next(t())}catch(u){r.error(u)}c.unsubscribe()}})}_connectSocket(){const{WebSocketCtor:n,protocol:t,url:s,binaryType:i}=this._config,r=this._output;let c=null;try{c=t?new n(s,t):new n(s),this._socket=c,i&&(this._socket.binaryType=i)}catch(l){return void r.error(l)}const u=new E.w(()=>{this._socket=null,c&&1===c.readyState&&c.close()});c.onopen=l=>{const{_socket:d}=this;if(!d)return c.close(),void this._resetState();const{openObserver:A}=this._config;A&&A.next(l);const M=this.destination;this.destination=N.L.create(g=>{if(1===c.readyState)try{const{serializer:h}=this._config;c.send(h(g))}catch(h){this.destination.error(h)}},g=>{const{closingObserver:h}=this._config;h&&h.next(void 0),g&&g.code?c.close(g.code,g.reason):r.error(new TypeError("WebSocketSubject.error must be called with an object with an error code, and an optional reason: { code: number, reason: string }")),this._resetState()},()=>{const{closingObserver:g}=this._config;g&&g.next(void 0),c.close(),this._resetState()}),M&&M instanceof S.t&&u.add(M.subscribe(this.destination))},c.onerror=l=>{this._resetState(),r.error(l)},c.onclose=l=>{this._resetState();const{closeObserver:d}=this._config;d&&d.next(l),l.wasClean?r.complete():r.error(l)},c.onmessage=l=>{try{const{deserializer:d}=this._config;r.next(d(l))}catch(d){r.error(d)}}}_subscribe(n){const{source:t}=this;return t?t.subscribe(n):(this._socket||this._connectSocket(),this._output.subscribe(n),n.add(()=>{const{_socket:s}=this;0===this._output.observers.length&&(s&&1===s.readyState&&s.close(),this._resetState())}),n)}unsubscribe(){const{_socket:n}=this;n&&1===n.readyState&&n.close(),this._resetState(),super.unsubscribe()}}var C=a(2340),F=a(7489),m=a(1777),G=a(7261),f=a(9224),O=a(7322),P=a(8833),v=a(3075),W=a(4623),z=a(7238),B=a(7423);const R=["newMessage"],D=["allMessages"];function Q(o,n){if(1&o&&(e.TgZ(0,"mat-list-item",11),e.TgZ(1,"span",12),e._uU(2),e.qZA(),e.TgZ(3,"span",13),e._uU(4),e.qZA(),e.TgZ(5,"span",14),e._uU(6),e.ALo(7,"date"),e.qZA(),e.qZA()),2&o){const t=n.$implicit;e.ekj("bg-gray-50","Me"==t.name),e.MGl("matTooltip","ip: ",t.ip,""),e.Q6J("@messageTrigger",void 0),e.xp6(2),e.Oqu(t.name),e.xp6(1),e.ekj("text-right","Me"==t.name),e.xp6(1),e.Oqu(t.message),e.xp6(2),e.Oqu(e.xi3(7,9,t.timestamp,"shortTime"))}}let I=(()=>{class o{constructor(t,s){this.document=t,this.snackbar=s,this.messages=[],this.subject=function j(o){return new y(o)}(C.N.WS_ENDPOINT),this.userName="",this.message=""}ngOnInit(){this.subject.pipe((0,w.U)(t=>{let s=t;return s.name===this.userName&&(s.name="Me"),s})).subscribe(t=>{this.messages.push(t),setTimeout(()=>{let s=this.allMessages.nativeElement;s.scrollTop=s.scrollHeight},50)},t=>{console.log("error",t)},()=>console.log("complete")),this.userName=this.createDefaultUserName()}ngOnDestroy(){this.subject.unsubscribe()}sendMessage(){var t;this.subject.next({name:this.userName,message:this.message,timestamp:(new Date).toISOString()}),this.message="",null===(t=this.newMessageEl)||void 0===t||t.nativeElement.focus()}createDefaultUserName(){return"user-"+F.random(1e3,9999).toString()}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(p.K0),e.Y36(G.ux))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-web-socket"]],viewQuery:function(t,s){if(1&t&&(e.Gf(R,5),e.Gf(D,5,e.SBq)),2&t){let i;e.iGM(i=e.CRH())&&(s.newMessageEl=i.first),e.iGM(i=e.CRH())&&(s.allMessages=i.first)}},decls:24,vars:6,consts:[[1,"container","mx-auto"],[1,"mat-elevation-z8","mx-auto"],[1,"user-name"],["matInput","",3,"ngModel","ngModelChange"],[1,"messages"],["allMessages",""],[3,"bg-gray-50","matTooltip",4,"ngFor","ngForOf"],[1,"message"],["matInput","","autofocus","",3,"ngModel","disabled","ngModelChange","keydown.enter"],["newMessage",""],["mat-raised-button","","color","default",3,"disabled","click"],[3,"matTooltip"],[1,"message-display-name"],[1,"message-display-message"],[1,"message-display-timestamp"]],template:function(t,s){1&t&&(e.TgZ(0,"main",0),e.TgZ(1,"mat-card",1),e.TgZ(2,"mat-card-title"),e.TgZ(3,"h2"),e._uU(4,"Chat"),e.qZA(),e.qZA(),e.TgZ(5,"mat-card-content"),e.TgZ(6,"mat-form-field",2),e.TgZ(7,"mat-label"),e._uU(8,"Your name"),e.qZA(),e.TgZ(9,"input",3),e.NdJ("ngModelChange",function(r){return s.userName=r}),e.qZA(),e.qZA(),e.TgZ(10,"div",4),e.TgZ(11,"mat-list",null,5),e.YNc(13,Q,8,12,"mat-list-item",6),e.qZA(),e.qZA(),e.TgZ(14,"mat-form-field",7),e.TgZ(15,"mat-label"),e._uU(16,"Message"),e.qZA(),e.TgZ(17,"input",8,9),e.NdJ("ngModelChange",function(r){return s.message=r})("keydown.enter",function(){return s.sendMessage()}),e.qZA(),e.qZA(),e.qZA(),e.TgZ(19,"mat-card-actions"),e.TgZ(20,"button",10),e.NdJ("click",function(){return s.sendMessage()}),e._uU(21,"SEND MESSAGE"),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.TgZ(22,"h2"),e._uU(23,"web-socket works!"),e.qZA()),2&t&&(e.Q6J("@page",void 0),e.xp6(9),e.Q6J("ngModel",s.userName),e.xp6(4),e.Q6J("ngForOf",s.messages),e.xp6(4),e.Q6J("ngModel",s.message)("disabled",!s.userName.length),e.xp6(3),e.Q6J("disabled",!s.userName.length||!s.message.length))},directives:[f.a8,f.n5,f.dn,O.KE,O.hX,P.Nt,v.Fj,v.JJ,v.On,W.i$,p.sg,W.Tg,z.gM,f.hq,B.lW],pipes:[p.uU],styles:["mat-card[_ngcontent-%COMP%]{margin-top:1rem;max-width:700px}mat-card-content[_ngcontent-%COMP%]{display:flex;flex-direction:column}.user-input[_ngcontent-%COMP%]{display:flex;flex-direction:column}mat-form-field.user-name[_ngcontent-%COMP%]{width:9rem}.message-display-name[_ngcontent-%COMP%]{margin-right:.5rem;font-size:.875rem;line-height:1.25rem;--tw-text-opacity: 1;color:rgb(156 163 175 / var(--tw-text-opacity))}.message-display-message[_ngcontent-%COMP%]{width:100%;max-width:400px;margin-right:.5rem;font-size:1rem;line-height:1.5rem}.message-display-timestamp[_ngcontent-%COMP%]{margin-left:auto;width:6rem;font-size:.875rem;line-height:1.25rem}.message[_ngcontent-%COMP%]{margin-top:1.5rem}div.messages[_ngcontent-%COMP%]{min-height:100%;border-radius:.5rem;border-width:2px;padding:0}mat-list[_ngcontent-%COMP%]{height:15rem;overflow-y:auto}"],data:{animation:[(0,m.X$)("messageTrigger",[(0,m.eR)(":enter",[(0,m.oB)({opacity:0,transform:"scale(0.7) translateX(100px)"}),(0,m.jt)("300ms ease-in",(0,m.oB)({opacity:1,transform:"scale(1) translateX(0)"}))])]),(0,m.X$)("page",[(0,m.eR)(":enter",[(0,m.oB)({opacity:0,transform:"scale(1) translateY(0)"}),(0,m.jt)("300ms ease-in",(0,m.oB)({opacity:1,transform:"scale(1) translateY(0)"}))])])]}}),o})();var L=a(4466);let x=(()=>{class o{constructor(t,s){this.router=t,this.document=s}canActivate(t,s){return"https:"!==this.document.location.protocol||(this.document.location.protocol="http:",this.document.location.replace("http://"+this.document.location.host+"/#/web-socket?showState=false&showSubmenu=false"),!1)}canDeactivate(t,s,i,r){return!C.N.production||"http:"!==this.document.location.protocol||(this.document.location.replace("https://"+this.document.location.host),!1)}}return o.\u0275fac=function(t){return new(t||o)(e.LFG(Z.F0),e.LFG(p.K0))},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();const Y=[{path:"",component:I,canActivate:[x],canDeactivate:[x]}];let X=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[[p.ez,L.m,Z.Bz.forChild(Y)]]}),o})()}}]);