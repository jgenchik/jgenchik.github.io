"use strict";var ot=Object.defineProperty,it=Object.defineProperties,at=Object.getOwnPropertyDescriptors,P=Object.getOwnPropertySymbols,st=Object.prototype.hasOwnProperty,lt=Object.prototype.propertyIsEnumerable,M=(g,c,i)=>c in g?ot(g,c,{enumerable:!0,configurable:!0,writable:!0,value:i}):g[c]=i,y=(g,c)=>{for(var i in c||(c={}))st.call(c,i)&&M(g,i,c[i]);if(P)for(var i of P(c))lt.call(c,i)&&M(g,i,c[i]);return g},Z=(g,c)=>it(g,at(c));(self.webpackChunkcvs=self.webpackChunkcvs||[]).push([[875],{875:(g,c,i)=>{i.r(c),i.d(c,{WebauthnModule:()=>rt});var T=i(9808),C=i(9516),p=i(655);function W(n,o,e,r,s,a,u){try{var l=n[a](u),m=l.value}catch(E){return void e(E)}l.done?o(m):Promise.resolve(m).then(r,s)}function x(n){return function(){var o=this,e=arguments;return new Promise(function(r,s){var a=n.apply(o,e);function u(m){W(a,r,s,u,l,"next",m)}function l(m){W(a,r,s,u,l,"throw",m)}u(void 0)})}}function F(n){return(new TextEncoder).encode(n)}function v(n){const o=new Uint8Array(n);let e="";for(const s of o)e+=String.fromCharCode(s);return btoa(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function w(n){const o=n.replace(/-/g,"+").replace(/_/g,"/"),r=o.padEnd(o.length+(4-o.length%4)%4,"="),s=atob(r),a=new ArrayBuffer(s.length),u=new Uint8Array(a);for(let l=0;l<s.length;l++)u[l]=s.charCodeAt(l);return a}function I(){return void 0!==(null==window?void 0:window.PublicKeyCredential)&&"function"==typeof window.PublicKeyCredential}function O(n){const{id:o}=n;return Z(y({},n),{id:w(o)})}function S(){return(S=x(function*(n){if(!I())throw new Error("WebAuthn is not supported in this browser");const o=Z(y({},n),{challenge:w(n.challenge),user:Z(y({},n.user),{id:F(n.user.id)}),excludeCredentials:n.excludeCredentials.map(O)}),e=yield navigator.credentials.create({publicKey:o});if(!e)throw new Error("Registration was not completed");const{id:r,rawId:s,response:a,type:u}=e,l={id:r,rawId:v(s),response:{attestationObject:v(a.attestationObject),clientDataJSON:v(a.clientDataJSON)},type:u,clientExtensionResults:e.getClientExtensionResults()};return"function"==typeof a.getTransports&&(l.transports=a.getTransports()),l})).apply(this,arguments)}function _(n){return new TextDecoder("utf-8").decode(n)}function N(){return(N=x(function*(n){var o,e;if(!I())throw new Error("WebAuthn is not supported in this browser");let r;0!==(null===(o=n.allowCredentials)||void 0===o?void 0:o.length)&&(r=null===(e=n.allowCredentials)||void 0===e?void 0:e.map(O));const s=Z(y({},n),{challenge:w(n.challenge),allowCredentials:r}),a=yield navigator.credentials.get({publicKey:s});if(!a)throw new Error("Authentication was not completed");const{id:u,rawId:l,response:m,type:E}=a;let D;return m.userHandle&&(D=_(m.userHandle)),{id:u,rawId:v(l),response:{authenticatorData:v(m.authenticatorData),clientDataJSON:v(m.clientDataJSON),signature:v(m.signature),userHandle:D},type:E,clientExtensionResults:a.getClientExtensionResults()}})).apply(this,arguments)}var h=i(3075),t=i(5e3),d=i(8966),b=i(7322),Y=i(8833),U=i(7423);function $(n,o){1&n&&(t.TgZ(0,"mat-error"),t._uU(1,"Login ID required"),t.qZA())}function J(n,o){1&n&&(t.TgZ(0,"mat-error"),t._uU(1,"User name required"),t.qZA())}let H=(()=>{class n{constructor(e,r){this.fb=e,this.dialogRef=r,this.form=this.makeForm()}ngOnInit(){}submitForm(){this.dialogRef.close(this.form.value)}makeForm(){return this.fb.group({loginId:["",[h.kI.required]],userName:["",[h.kI.required]]})}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(h.qu),t.Y36(d.so))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-egister-dialog"]],decls:19,vars:4,consts:[["mat-dialog-title",""],["novalidate","",3,"formGroup","ngSubmit"],["matInput","","placeholder","Login Id","formControlName","loginId"],[4,"ngIf"],["matInput","","placeholder","User Name","formControlName","userName"],["mat-button","","color","primary","type","submit",3,"disabled"],["mat-button","","mat-dialog-close",""]],template:function(e,r){1&e&&(t.TgZ(0,"h2",0),t._uU(1,"Register User"),t.qZA(),t.TgZ(2,"form",1),t.NdJ("ngSubmit",function(){return r.submitForm()}),t.TgZ(3,"mat-dialog-content"),t.TgZ(4,"mat-form-field"),t._UZ(5,"input",2),t.TgZ(6,"mat-hint"),t._uU(7,"Use your email"),t.qZA(),t.YNc(8,$,2,0,"mat-error",3),t.qZA(),t.TgZ(9,"mat-form-field"),t._UZ(10,"input",4),t.TgZ(11,"mat-hint"),t._uU(12,"Full name"),t.qZA(),t.YNc(13,J,2,0,"mat-error",3),t.qZA(),t.qZA(),t.TgZ(14,"mat-dialog-actions"),t.TgZ(15,"button",5),t._uU(16,"REGISTER"),t.qZA(),t.TgZ(17,"button",6),t._uU(18,"Cancel"),t.qZA(),t.qZA(),t.qZA()),2&e&&(t.xp6(2),t.Q6J("formGroup",r.form),t.xp6(6),t.Q6J("ngIf",r.form.get("loginId").hasError("required")),t.xp6(5),t.Q6J("ngIf",r.form.get("userName").hasError("required")),t.xp6(2),t.Q6J("disabled",!r.form.valid))},directives:[d.uh,h._Y,h.JL,h.sg,d.xY,b.KE,Y.Nt,h.Fj,h.JJ,h.u,b.bx,T.O5,b.TO,d.H8,U.lW,d.ZT],styles:["mat-dialog-content[_ngcontent-%COMP%]{display:flex;flex-direction:column}"]}),n})();var q=i(2198),L=i(4107),z=i(508);function k(n,o){if(1&n&&(t.TgZ(0,"mat-option",6),t._uU(1),t.qZA()),2&n){const e=o.$implicit;t.Q6J("value",e),t.xp6(1),t.hij(" ",e," ")}}let K=(()=>{class n{constructor(e,r){this.dialogRef=e,this.data=r,this.allUserIds$=this.data,this.selectedUserId=void 0}ngOnInit(){}selectLoginId(){this.dialogRef.close(this.selectedUserId)}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(d.so),t.Y36(d.WI))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-select-userid"]],decls:14,vars:4,consts:[["mat-dialog-title",""],["appearance","fill"],[3,"value","valueChange"],[3,"value",4,"ngFor","ngForOf"],["mat-button","","color","primary",3,"click"],["mat-button","","mat-dialog-close",""],[3,"value"]],template:function(e,r){1&e&&(t.TgZ(0,"h2",0),t._uU(1,"Select User"),t.qZA(),t.TgZ(2,"mat-dialog-content"),t.TgZ(3,"mat-form-field",1),t.TgZ(4,"mat-label"),t._uU(5,"User Id"),t.qZA(),t.TgZ(6,"mat-select",2),t.NdJ("valueChange",function(a){return r.selectedUserId=a}),t.YNc(7,k,2,2,"mat-option",3),t.ALo(8,"async"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(9,"mat-dialog-actions"),t.TgZ(10,"button",4),t.NdJ("click",function(){return r.selectLoginId()}),t._uU(11,"LOGIN"),t.qZA(),t.TgZ(12,"button",5),t._uU(13,"Cancel"),t.qZA(),t.qZA()),2&e&&(t.xp6(6),t.Q6J("value",r.selectedUserId),t.xp6(1),t.Q6J("ngForOf",t.lcZ(8,2,r.allUserIds$)))},directives:[d.uh,d.xY,b.KE,b.hX,L.gD,T.sg,z.ey,d.H8,U.lW,d.ZT],pipes:[T.Ov],styles:[""]}),n})();var j=i(4850),A=i(2340),Q=i(520);let X=(()=>{class n{constructor(e){this.http=e}getRegistrationOptions(e,r){return(0,p.mG)(this,void 0,void 0,function*(){return this.http.get(`${A.N.WEBAUTHN_DOMAIN}/webauthn/registration-options?username=${r}&id=${e}`).toPromise()})}startRegistration(e,r,s){return(0,p.mG)(this,void 0,void 0,function*(){return this.http.post(`${A.N.WEBAUTHN_DOMAIN}/webauthn/start-registration?username=${s}&id=${r}`,e).toPromise()})}getAllUserids(){return this.http.get(`${A.N.WEBAUTHN_DOMAIN}/webauthn/all-users`).pipe((0,j.U)(e=>Object.keys(e)))}getAuthenticationOptions(e){return(0,p.mG)(this,void 0,void 0,function*(){return this.http.get(`${A.N.WEBAUTHN_DOMAIN}/webauthn/authentication-options?id=${e}`).toPromise()})}verifyAuthentication(e,r){return(0,p.mG)(this,void 0,void 0,function*(){return this.http.post(`${A.N.WEBAUTHN_DOMAIN}/webauthn/verify-authentication?id=${r}`,e).toPromise()})}}return n.\u0275fac=function(e){return new(e||n)(t.LFG(Q.eN))},n.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var V=i(7261),f=i(9224);let tt=(()=>{class n{constructor(e,r,s,a){this.webauthnService=e,this.dialog=r,this.router=s,this.snackBar=a,this.allUserIds$=this.getAllUserIds()}ngOnInit(){return(0,p.mG)(this,void 0,void 0,function*(){let e=navigator.credentials;if(console.log("credentialsContainer",e),"credentials"in navigator)try{let r=yield navigator.credentials.get({});console.log("creds",r)}catch(r){console.log("error:",r)}finally{console.log("credentials GET done")}})}showRegisterDialog(){this.dialog.open(H,{}).afterClosed().pipe((0,q.h)(r=>!!r)).subscribe(r=>{console.log("registrationData: ",r),this.register(r.loginId,r.userName)})}register(e="test@email.com",r="John Smith"){return(0,p.mG)(this,void 0,void 0,function*(){const s=yield this.webauthnService.getRegistrationOptions(e,r);let a,u;try{a=yield function G(n){return S.apply(this,arguments)}(s)}catch(l){"InvalidStateError"===(null==l?void 0:l.name)?console.log("Error: Authenticator was probably already registered by user"):console.log("error",l)}a&&(u=yield this.webauthnService.startRegistration(a,e,r),u&&u.verified?(console.log("Success"),this.snackBar.open(`Success! User ${r} registered.`,"",{duration:3e3})):console.log("Error"))})}authenticate(e){return(0,p.mG)(this,void 0,void 0,function*(){const r=yield this.webauthnService.getAuthenticationOptions(e);let s;try{s=yield function B(n){return N.apply(this,arguments)}(r)}catch(a){console.error(a)}if(s){const a=yield this.webauthnService.verifyAuthentication(s,e);a&&a.verified?(console.log("Success!"),this.router.navigate(["./webauthn/auth-success"],{queryParams:{loginId:a.loginId,userName:a.userName}})):(console.error("Not authorized"),this.snackBar.open("Not Authorized","",{duration:3e3}))}})}showSelectUserDialog(){this.dialog.open(K,{data:this.allUserIds$}).afterClosed().pipe((0,q.h)(r=>!!r)).subscribe(r=>{console.log("The dialog was closed. result",r),this.authenticate(r)})}getAllUserIds(){return this.webauthnService.getAllUserids()}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(X),t.Y36(d.uw),t.Y36(C.F0),t.Y36(V.ux))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-webauthn"]],decls:11,vars:0,consts:[[1,"mat-elevation-z12"],["mat-card-md-image","","src","../../assets/images/webauthn.jpg"],["mat-raised-button","",3,"click"]],template:function(e,r){1&e&&(t.TgZ(0,"mat-card",0),t.TgZ(1,"mat-card-title"),t._uU(2,"Web Authentication"),t.qZA(),t.TgZ(3,"mat-card-subtitle"),t._uU(4,"Biometrics"),t.qZA(),t._UZ(5,"img",1),t.TgZ(6,"mat-card-actions"),t.TgZ(7,"button",2),t.NdJ("click",function(){return r.showRegisterDialog()}),t._uU(8,"REGISTER"),t.qZA(),t.TgZ(9,"button",2),t.NdJ("click",function(){return r.showSelectUserDialog()}),t._uU(10,"AUTHENTICATE"),t.qZA(),t.qZA(),t.qZA())},directives:[f.a8,f.n5,f.$j,f.nc,f.hq,U.lW],styles:["mat-card[_ngcontent-%COMP%]{margin-left:.5rem;margin-right:.5rem;margin-top:2rem;width:auto}@media (min-width: 768px){mat-card[_ngcontent-%COMP%]{margin-left:auto;margin-right:auto}mat-card[_ngcontent-%COMP%]{max-width:56rem}}img[_ngcontent-%COMP%]{width:auto}"]}),n})();var et=i(4466);const nt=[{path:"",component:tt},{path:"auth-success",component:(()=>{class n{constructor(e,r){this.router=e,this.route=r,this.loginId=null,this.userName=null}ngOnInit(){this.route.queryParamMap.subscribe(e=>{this.userName=e.get("userName")})}goBack(){this.router.navigate(["/webauthn"])}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(C.F0),t.Y36(C.gz))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-auth-success"]],decls:12,vars:1,consts:[[1,"container","mx-auto"],[1,"mat-elevation-z12"],[1,"user-name"],["mat-button","","color","primary",3,"click"]],template:function(e,r){1&e&&(t.TgZ(0,"div",0),t.TgZ(1,"mat-card",1),t.TgZ(2,"mat-card-title"),t.TgZ(3,"h2"),t._uU(4,"Authentication sucessfull"),t.qZA(),t.qZA(),t.TgZ(5,"mat-card-content"),t.TgZ(6,"div",2),t._uU(7),t.qZA(),t._uU(8," You had succesfully authenticated. Welcome! "),t.qZA(),t.TgZ(9,"mat-card-actions"),t.TgZ(10,"button",3),t.NdJ("click",function(){return r.goBack()}),t._uU(11,"GO BACK"),t.qZA(),t.qZA(),t.qZA(),t.qZA()),2&e&&(t.xp6(7),t.Oqu(r.userName))},directives:[f.a8,f.n5,f.dn,f.hq,U.lW],styles:["mat-card[_ngcontent-%COMP%]{margin-left:.5rem;margin-right:.5rem;margin-top:1rem;width:auto}@media (min-width: 768px){mat-card[_ngcontent-%COMP%]{margin-left:0;margin-right:0}mat-card[_ngcontent-%COMP%]{max-width:56rem}}.mat-card-title[_ngcontent-%COMP%]{--tw-bg-opacity: 1;background-color:rgb(209 213 219 / var(--tw-bg-opacity));padding:1rem}mat-card-content[_ngcontent-%COMP%]{margin-top:1.5rem;padding-top:1.5rem;text-align:center;font-size:1.25rem;line-height:1.75rem}.user-name[_ngcontent-%COMP%]{font-size:1.5rem;line-height:2rem;--tw-text-opacity: 1;color:rgb(185 28 28 / var(--tw-text-opacity))}"]}),n})()}];let rt=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[[T.ez,et.m,C.Bz.forChild(nt)]]}),n})()}}]);